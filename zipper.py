import requests
import json


base_url = "http://localhost/test"
username = ""
password = ""
hostid = ""

#login through api to get token
login_payload = {"jsonrpc":"2.0", "method":"user.login", "params":{"user":username, "password":password}, "id":1}
z = requests.post(base_url + "/api_jsonrpc.php", headers={"Content-Type":"application/json"}, data=json.dumps(login_payload))

#store json response in array, grab token 
login_response = json.loads(z.text)
token = login_response["result"]


#give user code execution visual
while True:
	cmd = input("Go on.. enter your command : ")
	if cmd != "":
		


		#use user's command to update script through api
		update_payload = {"jsonrpc":"2.0", "method":"script.update", "params":{"scriptid":"1", "command":cmd}, "auth":token, "id":1}
		z1 = requests.post(base_url + "/api_jsonrpc.php", headers={"Content-Type":"application/json"}, data=json.dumps(update_payload))

		#execute updated script
		exec_payload = {"jsonrpc":"2.0", "method":"script.execute", "params":{"scriptid":"1", "hostid": hostid}, "auth":token, "id":1}
		z2 = requests.post(base_url + "/api_jsonrpc.php", headers={"Content-Type":"application/json"}, data=json.dumps(exec_payload))

		#store json response in array, grab cmd output
		z2_response = json.loads(z2.text)
		cmd_result = z2_response["result"]["value"]
		print("\n\n" + cmd_result)

	elif cmd == "exit" or "quit" or "q" :
		quit()
